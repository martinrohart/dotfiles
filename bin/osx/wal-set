#!/usr/bin/env bash

###

# -- script to set colors generated by wal
# https://github.com/dylanaraps/pywal

ubersicht_css="$HOME/dotfiles/conf/osx/ubersicht/widgets/nerdbar.widget/colors.css"
wal_css="$HOME/.cache/wal/colors.css"
chunkwmrc=$HOME/dotfiles/conf/osx/chunkwm/.chunkwmrc

# update Übersicht with wal colors
reload_bar() {
  # if the wal css is present, remove the last 28 lines (length of wal css)
  if grep -q :root "$ubersicht_css" ;then
    ed -s "$ubersicht_css" <<< $'-27,$d\nwq'
  fi
  cat "$HOME/.cache/wal/colors.css" >> "$ubersicht_css"
  osascript -e 'tell application "Übersicht" to refresh'
}

# update chunkwm tiling border color with color1 from wal
reload_chunkwm_tile() {
  border_color=$(grep color1:  "$wal_css" | awk -F'#' '{print $2}' | sed 's/;$//')
  # find chunkc set focused_border_color and replace 0xff this
  sed -i.bak "s/.*chunkc set focused_border_color.*/chunkc set focused_border_color     0xff${border_color}/" "$chunkwmrc"
  brew services restart chunkwm
}

reload_alacritty_color() {
  end

}

main() {
  reload_alacritty_color
  reload_bar
  reload_chunkwm_tile
}

main
